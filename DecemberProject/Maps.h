#pragma once

const uint8_t PROGMEM ROOMNULL[] ={
//Width, Height;
9,9,
1,1,1,1,1,1,1,1,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,1,1,1,1,1,1,1,1,
};

const uint8_t PROGMEM ROOMC[] ={
//Width, Height;
9,9,
1,1,1,1,2,1,1,1,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
2,0,0,0,0,0,0,0,2,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,1,1,1,2,1,1,1,1,
};

const uint8_t PROGMEM ROOMRD[] ={
//Width, Height;
9,9,
1,1,1,1,1,1,1,1,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,2,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,1,1,1,2,1,1,1,1,
};

const uint8_t PROGMEM ROOMLD[] ={
//Width, Height;
9,9,
1,1,1,1,1,1,1,1,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
2,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,1,1,1,2,1,1,1,1,
};

const uint8_t PROGMEM ROOMRU[] ={
//Width, Height;
9,9,
1,1,1,1,2,1,1,1,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,2,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,1,1,1,1,1,1,1,1,
};

const uint8_t PROGMEM ROOMLU[] ={
//Width, Height;
9,9,
1,1,1,1,2,1,1,1,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
2,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,1,1,1,1,1,1,1,1,
};

const uint8_t PROGMEM ROOMEL[] ={
//Width, Height;
9,9,
1,1,1,1,1,1,1,1,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
2,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,1,1,1,1,1,1,1,1,
};

const uint8_t PROGMEM ROOMER[] ={
//Width, Height;
9,9,
1,1,1,1,1,1,1,1,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,2,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,1,1,1,1,1,1,1,1,
};

const uint8_t PROGMEM ROOMEU[] ={
//Width, Height;
9,9,
1,1,1,1,2,1,1,1,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,1,1,1,1,1,1,1,1,
};

const uint8_t PROGMEM ROOMED[] ={
//Width, Height;
9,9,
1,1,1,1,1,1,1,1,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,0,0,0,0,0,0,0,1,
1,1,1,1,2,1,1,1,1,
};


const uint8_t PROGMEM HALLUD[] ={
//Width, Height;
5,9,
1,1,2,1,1,
1,0,0,0,1,
1,0,0,0,1,
1,0,0,0,1,
1,0,0,0,1,
1,0,0,0,1,
1,0,0,0,1,
1,0,0,0,1,
1,1,2,1,1,
};

const uint8_t PROGMEM HALLLR[] ={
//Width, Height;
9,5,
1,1,1,1,1,1,1,1,1,
1,0,0,0,0,0,0,0,1,
2,0,0,0,0,0,0,0,2,
1,0,0,0,0,0,0,0,1,
1,1,1,1,1,1,1,1,1,
};

const uint8_t PROGMEM HALLUDL[] ={
//Width, Height;
5,9,
1,1,2,1,1,
1,0,0,0,1,
1,0,0,0,1,
1,0,0,0,1,
2,0,0,0,1,
1,0,0,0,1,
1,0,0,0,1,
1,0,0,0,1,
1,1,2,1,1,
};

const uint8_t PROGMEM HALLUDR[] ={
//Width, Height;
5,9,
1,1,2,1,1,
1,0,0,0,1,
1,0,0,0,1,
1,0,0,0,1,
1,0,0,0,2,
1,0,0,0,1,
1,0,0,0,1,
1,0,0,0,1,
1,1,2,1,1,
};

const uint8_t PROGMEM HALLLRU[] ={
//Width, Height;
9,5,
1,1,1,1,2,1,1,1,1,
1,0,0,0,0,0,0,0,1,
2,0,0,0,0,0,0,0,2,
1,0,0,0,0,0,0,0,1,
1,1,1,1,1,1,1,1,1,
};

const uint8_t PROGMEM HALLLRD[] ={
//Width, Height;
9,5,
1,1,1,1,1,1,1,1,1,
1,0,0,0,0,0,0,0,1,
2,0,0,0,0,0,0,0,2,
1,0,0,0,0,0,0,0,1,
1,1,1,1,2,1,1,1,1,
};

/*
  Null,
  RoomCenter,
  RoomLeftDown,
  RoomLeftUp,
  RoomRightDown,
  RoomRightUp,
  RoomEndUp,
  RoomEndDown,
  RoomEndLeft,
  RoomEndRight,
  HallVer,
  HallHor,
  HallHorUp,
  HallHorDown,
  HallVerRight,
  HallVerLeft,
*/
const uint8_t * Rooms[] = {ROOMNULL,ROOMC,ROOMLD,ROOMLU,ROOMRD,ROOMRU,ROOMEU,ROOMED,ROOMEL,ROOMER,HALLUD,HALLLR,HALLLRU,HALLLRD,HALLUDR,HALLUDL};
const uint8_t * CRoom;

void SetRoom(uint8_t r){
  CRoom = Rooms[r];
}

unsigned GetTileX(unsigned x)
{
      return (x / TILE_SIZE);
}

unsigned GetTileY(unsigned y)
{
      return (y / TILE_SIZE);
}

unsigned GetTileXOffset(unsigned x)
{
      return (x % TILE_SIZE);
}

unsigned GetTileYOffset(unsigned y)
{
      return (y % TILE_SIZE);
}


uint8_t GetBlock(uint16_t x, uint16_t y) {
  uint8_t Block = 0;
  uint8_t MX = pgm_read_byte(&CRoom[0]);
  uint8_t MY = pgm_read_byte(&CRoom[1]);
  if ((x < 0) || (y < 0) || (x >= MX) || (y >= MY)) {
    Block = 0;
  }
  else
  {
    uint16_t Index = ((x + (y * MX))+2);
    Block =  pgm_read_byte(&CRoom[Index]);
  }
  return Block;
}

uint8_t GetBlockTrans(uint16_t x, uint16_t y) {
  uint8_t Block = 0;
  uint8_t MX = pgm_read_byte(&CRoom[0]);
  uint8_t MY = pgm_read_byte(&CRoom[1]);
  if ((x < 0) || (y < 0) || (x >= MX) || (y >= MY)) {
    Block = 0;
  }
  else
  {
    uint8_t p[4];
    uint8_t Block = GetBlock(x,y);
    p[2] = GetBlock(x+1,y);
    p[3] = GetBlock(x-1,y);
    p[1] = GetBlock(x,y+1);
    p[0] = GetBlock(x,y-1);
    
    if (Block == 1){
        
        if((p[0]==1)&&(p[1]==1)){
            Block = 0;
        }
        if((p[2]==1)&&(p[3]==1)){
            Block = 1;
        }
        
        if((p[0]==1)&&(p[1]==0)&&(p[2]==0)&&(p[3]==1)){
            Block = 2;
        }
        if((p[0]==1)&&(p[1]==0)&&(p[2]==1)&&(p[3]==0)){
            Block = 3;
        }
        if((p[0]==0)&&(p[1]==1)&&(p[2]==0)&&(p[3]==1)){
            Block = 4;
        }
        if((p[0]==0)&&(p[1]==1)&&(p[2]==1)&&(p[3]==0)){
            Block = 5;
        }
        return Block;
    } 
  }
  return Block;
}

bool Walkable(unsigned x, unsigned y) {
  uint8_t p[4];
  bool Walk = true; 
  p[0] = (GetBlock(GetTileX(x-4), GetTileY(y-4)));
  p[1] = (GetBlock(GetTileX(x+3), GetTileY(y-4)));
  p[2] = (GetBlock(GetTileX(x-4), GetTileY(y+3)));
  p[3] = (GetBlock(GetTileX(x+3), GetTileY(y+3)));
  for (byte i=0; i<4;i++){
    if (!((p[i] == 0))){
        Walk = false;
        break;
      }
  }
  return Walk;
}





